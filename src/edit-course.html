<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Course Structure</title>
    <link rel="stylesheet" href="styles.css"> <!-- Link to your main CSS -->
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f9f9f9;
        }
        h1 {
            color: #333;
        }
        .instruction {
            margin-bottom: 20px;
            font-style: italic;
            color: #555;
        }
        form {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        label {
            display: block;
            margin: 10px 0 5px;
            font-weight: bold;
        }
        input[type="text"], textarea {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .module, .lesson {
            margin-bottom: 15px;
        }
        .module > label {
            font-size: 18px;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 10px;
        }
        .lesson > input[type="text"] {
            width: calc(100% - 20px);
            padding: 6px;
            margin-left: 20px;
        }
        input[type="submit"] {
            background-color: #28a745;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        input[type="submit"]:hover {
            background-color: #218838;
        }
    </style>
</head>
<body>
<h1>Edit Course Details</h1>
<p class="instruction">Please review and modify the modules and times as necessary.</p>
<form id="courseForm">
    <label for="courseTitle">Course Title:</label>
    <input type="text" id="courseTitle" name="courseTitle">

    <label for="courseDescription">Course Description:</label>
    <textarea id="courseDescription" name="courseDescription"></textarea>

    <div id="modules">
        <!-- Modules and Lessons will be dynamically generated here -->
    </div>

    <input type="submit" value="Save Changes">
</form>

<script>
    // Function to extract data from URL query parameters
    function getQueryParams() {
      const params = {};
      window.location.search.substring(1).split('&').forEach(pair => {
        const [key, value] = pair.split('=');
        params[decodeURIComponent(key)] = decodeURIComponent(value || '');
      });
      return params;
    }

    // Function to populate form fields from the JSON data
    function populateForm(data) {
      document.getElementById('courseTitle').value = data.courseTitle || '';
      document.getElementById('courseDescription').value = data.courseDescription || '';

      const modulesDiv = document.getElementById('modules');
      modulesDiv.innerHTML = '';  // Clear existing content

      data.modules.forEach((module, moduleIndex) => {
        const moduleDiv = document.createElement('div');
        moduleDiv.className = 'module';

        const moduleNameInput = document.createElement('input');
        moduleNameInput.type = 'text';
        moduleNameInput.value = module.name;
        moduleDiv.appendChild(moduleNameInput);

        const moduleTimeInput = document.createElement('input');
        moduleTimeInput.type = 'text';
        moduleTimeInput.value = module.time;
        moduleTimeInput.style = 'margin-left: 10px;';
        moduleDiv.appendChild(moduleTimeInput);

        module.lessons.forEach((lesson, lessonIndex) => {
          const lessonDiv = document.createElement('div');
          lessonDiv.className = 'lesson';

          const lessonInput = document.createElement('input');
          lessonInput.type = 'text';
          lessonInput.value = `${lesson.name}`;
          lessonDiv.appendChild(lessonInput);

          const lessonTimeInput = document.createElement('input');
          lessonTimeInput.type = 'text';
          lessonTimeInput.value = `${lesson.time}`;
          lessonTimeInput.style = 'margin-left: 10px;';
          lessonDiv.appendChild(lessonTimeInput);

          moduleDiv.appendChild(lessonDiv);
        });

        modulesDiv.appendChild(moduleDiv);
      });
    }

    // Parse query parameters and decode the JSON string
    const params = getQueryParams();
    if (params.data) {
      try {
        const data = JSON.parse(decodeURIComponent(params.data));
        populateForm(data);
      } catch (e) {
        console.error('Error parsing JSON data:', e);
      }
    }

    // Handle form submission
    document.getElementById('courseForm').onsubmit = function(event) {
      event.preventDefault();
      const courseData = {
        courseTitle: document.getElementById('courseTitle').value,
        courseDescription: document.getElementById('courseDescription').value,
        modules: []
      };

      const modulesDiv = document.getElementById('modules').children;
      for (let i = 0; i < modulesDiv.length; i++) {
        const moduleDiv = modulesDiv[i];
        const moduleData = {
          name: moduleDiv.querySelector('input[type="text"]').value,
          time: moduleDiv.querySelectorAll('input[type="text"]')[1].value,
          lessons: []
        };

        const lessonsDiv = moduleDiv.getElementsByClassName('lesson');
        for (let j = 0; j < lessonsDiv.length; j++) {
          const lessonInputs = lessonsDiv[j].getElementsByTagName('input');
          moduleData.lessons.push({
            name: lessonInputs[0].value.trim(),
            time: lessonInputs[1].value.trim()
          });
        }

        courseData.modules.push(moduleData);
      }

      console.log(JSON.stringify(courseData));  // Output updated data to the console
      // You can send this updated data back to your server or store it locally
    };
</script>
</body>
</html>
